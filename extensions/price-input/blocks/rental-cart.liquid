<div class="cottage-rental-cart" data-role="root">
  <style>
    .cottage-rental-cart {
      border: 1px solid #e1e3e5;
      border-radius: 10px;
      padding: 16px;
      margin: 20px 0;
      background: #fff;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    }
    .cottage-rental-cart__title { margin: 0 0 12px 0; font-weight: 700; font-size: 16px; }
    .cottage-rental-cart__empty { color: #6b7280; font-size: 13px; margin: 0; }
    .cottage-rental-cart__list { display: flex; flex-direction: column; gap: 10px; margin-top: 10px; }
    .cottage-rental-cart__item {
      border: 1px solid #e5e7eb;
      border-radius: 10px;
      padding: 12px;
      display: flex;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
      background: #f9fafb;
    }
    .cottage-rental-cart__meta { display: flex; flex-direction: column; gap: 4px; }
    .cottage-rental-cart__meta strong { font-weight: 700; }
    .cottage-rental-cart__meta span { font-size: 13px; color: #111827; }
    .cottage-rental-cart__actions { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; margin-top: 14px; }
    .cottage-rental-cart__btn {
      border: 1px solid #111827;
      background: #111827;
      color: #fff;
      border-radius: 8px;
      padding: 10px 12px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
    }
    .cottage-rental-cart__btn--secondary { background: #fff; color: #111827; border-color: #d1d5db; }
    .cottage-rental-cart__btn--danger { background: #fff; color: #b91c1c; border-color: #fecaca; }
    .cottage-rental-cart__note { margin-top: 10px; font-size: 12px; color: #6b7280; }
  </style>

  <p class="cottage-rental-cart__title">{{ block.settings.heading }}</p>
  <p class="cottage-rental-cart__empty" data-role="empty" style="display:none;">
    {{ block.settings.empty_text }}
  </p>
  <div class="cottage-rental-cart__list" data-role="list"></div>

  <div class="cottage-rental-cart__actions">
    <button class="cottage-rental-cart__btn" type="button" data-role="checkout">
      {{ block.settings.checkout_label }}
    </button>
  </div>

  {% if block.settings.help_text != blank %}
    <div class="cottage-rental-cart__note">{{ block.settings.help_text }}</div>
  {% endif %}

  <script>
    (function () {
      var root = document.currentScript && document.currentScript.closest('.cottage-rental-cart');
      if (!root) return;
      var listEl = root.querySelector('[data-role="list"]');
      var emptyEl = root.querySelector('[data-role="empty"]');
      var checkoutBtn = root.querySelector('[data-role="checkout"]');

      function render() {
        // This block is now just a “Checkout” button helper.
        listEl.innerHTML = '';
        emptyEl.style.display = '';
      }

      async function startCheckout() {
        checkoutBtn.disabled = true;
        checkoutBtn.textContent = 'Starting checkout…';
        try {
          window.location.href = '/checkout';
        } catch (e) {
          alert(String(e && e.message ? e.message : e));
        } finally {
          checkoutBtn.disabled = false;
          checkoutBtn.textContent = '{{ block.settings.checkout_label | escape }}';
          render();
        }
      }

      checkoutBtn.addEventListener('click', startCheckout);

      render();
    })();
  </script>
</div>

{% schema %}
{
  "name": "Rental cart",
  "target": "section",
  "enabled_on": { "templates": ["cart"] },
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading", "default": "Your rentals" },
    { "type": "text", "id": "empty_text", "label": "Empty text", "default": "No rentals selected yet." },
    { "type": "text", "id": "checkout_label", "label": "Checkout button label", "default": "Checkout rentals" },
    { "type": "textarea", "id": "help_text", "label": "Help text", "default": "Rentals are added to your Shopify cart. Proceed to checkout when ready." }
  ]
}
{% endschema %}

